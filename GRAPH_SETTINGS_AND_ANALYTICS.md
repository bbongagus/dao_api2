# Graph Settings –∏ –°–∏—Å—Ç–µ–º–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### Graph Settings - —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend

#### ‚úÖ –ß—Ç–æ –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **–ß–µ—Ä–µ–∑ REST API** (`/api/graphs/:graphId`):
   - `nodes` - –≤—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–æ–¥ —Å –¥–µ—Ç—å–º–∏
   - `edges` - –≤—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏
   - `viewport` - –ø–æ–∑–∏—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–± canvas
   - `settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∞ (–ø–æ—Å–ª–µ –Ω–∞—à–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ settings**:
```javascript
{
  resetProgressEnabled: boolean,  // –í–∫–ª—é—á–µ–Ω –ª–∏ daily reset
  resetFrequency: 'daily' | 'weekly' | 'monthly',
  lastProgressReset: ISO_DATE_STRING,
  lastUpdated: ISO_DATE_STRING
}
```

3. **–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –Ω–æ–¥–∞—Ö**:
```javascript
{
  isDone: boolean,           // –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞
  currentCompletions: number, // –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
  requiredCompletions: number,// –¢—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
  calculatedProgress: number  // 0-1, –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
}
```

### ‚ùå –ß—Ç–æ –ù–ï –°–û–ë–ò–†–ê–ï–¢–°–Ø (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞):

1. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**:
   - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –∑–∞–¥–∞—á–∞–º–∏ (Focus Time –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ –∫–∞–∫ "24h")
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –Ω–∞—á–∞–ª–∞/–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π

2. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**:
   - –ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞
   - –ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –≤–ø–µ—Ä–≤—ã–µ –Ω–∞—á–∞—Ç–∞
   - –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã–≤–∞–ª–∞—Å—å
   - –¢—Ä–µ–Ω–¥—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**:
   - –ö–ª–∏–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
   - –í—Ä–µ–º—è –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏
   - –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç—ã

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ —Å–µ–π—á–∞—Å

### Frontend (graphy)

1. **PersistenceMixin.js**:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage –∫–∞–∫ backup
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ backend —á–µ—Ä–µ–∑ GraphFacade

2. **GraphFacade.js**:
   - –°–æ–±–∏—Ä–∞–µ—Ç snapshot –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ `/api/graphs/:graphId`
   - –í–∫–ª—é—á–∞–µ—Ç settings –≤ payload

3. **TreeDaoStore.js**:
   - –•—Ä–∞–Ω–∏—Ç settings –≤ Map: `graphSettings`
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç daily reset –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - –ù–ï –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

4. **AdaptiveDashboard**:
   - –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –ª–µ—Ç—É –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - Focus Time = "24h" (–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ)
   - Overall Progress = —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ
   - Active Items = –Ω–æ–¥—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º > 0

### Backend (dao_api2)

1. **simple-server.js**:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Redis: `graph:${graphId}`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç daily reset –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
   - –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
   - –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

2. **–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis**:
```javascript
{
  nodes: [...],      // –ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
  edges: [...],      // –°–≤—è–∑–∏
  viewport: {...},   // –ü–æ–∑–∏—Ü–∏—è canvas
  settings: {...},   // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∞
  version: number,   // –í–µ—Ä—Å–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  lastUpdated: ISO_STRING
}
```

## üö® –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** - –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ snapshot
2. **Focus Time —Ñ–µ–π–∫–æ–≤—ã–π** - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "24h"
3. **–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –∏–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–æ –≤—Ä–µ–º–µ–Ω–∏
4. **–ù–µ—Ç event tracking** - –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –§–∞–∑–∞ 1: Event Tracking
```javascript
// –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è
{
  eventType: 'progress_update',
  nodeId: 'uuid',
  timestamp: Date.now(),
  userId: 'user1',
  sessionId: 'session-uuid',
  data: {
    oldValue: 0.5,
    newValue: 0.7,
    trigger: 'manual' | 'auto'
  }
}
```

### –§–∞–∑–∞ 2: Analytics Storage
- –î–æ–±–∞–≤–∏—Ç—å Redis Streams –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- BullMQ worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫:
```javascript
// analytics:node:${nodeId}
{
  totalTimeSpent: seconds,
  firstStarted: ISO_STRING,
  lastActive: ISO_STRING,
  completionHistory: [
    { timestamp: ISO_STRING, value: 0.5 }
  ],
  sessionsCount: number
}
```

### –§–∞–∑–∞ 3: Real-time Metrics
- WebSocket –∫–∞–Ω–∞–ª –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ dashboard —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## üìã Checklist –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [x] Settings —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ REST API endpoint
- [x] Settings –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ GET –∑–∞–ø—Ä–æ—Å–µ
- [x] Settings –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket
- [ ] –î–æ–±–∞–≤–∏—Ç—å event tracking
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å analytics storage
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å real focus time tracking
- [ ] –î–æ–±–∞–≤–∏—Ç—å historical data API

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è MVP, –Ω–æ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. Graph Settings –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –¥–∞–Ω–Ω—ã—Ö.