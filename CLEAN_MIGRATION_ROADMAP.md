# Roadmap: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —á–∏—Å—Ç—É—é Optimistic UI –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

## –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–î–µ–Ω—å 1)

### –ó–∞–¥–∞—á–∏:
1. ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã - **–í–´–ü–û–õ–ù–ï–ù–û**
2. ‚úÖ –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏ –∫–æ—Å—Ç—ã–ª–µ–π - **–í–´–ü–û–õ–ù–ï–ù–û**
3. ‚úÖ –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã - **–í–´–ü–û–õ–ù–ï–ù–û**

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–æ—Å—Ç—ã–ª–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
- `_optimistic_bypass` —Ñ–ª–∞–≥
- `_callBaseMethod` —Å prototype —Ö–∞–∫–∞–º–∏
- –¶–µ–ø–æ—á–∫–∞ –∏–∑ 5 —Å–ª–æ—ë–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- BullMQ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –§–∞–∑–∞ 1: Proof of Concept (–î–µ–Ω—å 2)

### –°–æ–∑–¥–∞—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ä–∞–±–æ—á—É—é –≤–µ—Ä—Å–∏—é:

#### 1.1 Simple Backend
```bash
# –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
touch dao_api2/src/simple-server.js
```

–ö–æ–¥ (100 —Å—Ç—Ä–æ–∫):
- WebSocket —Å–µ—Ä–≤–µ—Ä
- REST endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ù–∏–∫–∞–∫–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π

#### 1.2 OptimisticStore
```bash
# –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π store
touch graphy/stores/OptimisticStore.js
```

–ö–æ–¥ (200 —Å—Ç—Ä–æ–∫):
- –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ TreeDaoStore
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- WebSocket –∫–ª–∏–µ–Ω—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–∫–∞—Ç—ã

#### 1.3 –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```bash
# –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
touch graphy/components/TestOptimistic.jsx
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞
- –†–∞–±–æ—Ç—É offline

## –§–∞–∑–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è (–î–µ–Ω—å 3)

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–∞—è | –¶–µ–ª—å | –ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å |
|---------|---------|------|--------------|
| Latency –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–∑–ª–∞ | ~50ms | <10ms | Performance API |
| –ü–∞–º—è—Ç—å –Ω–∞ 1000 —É–∑–ª–æ–≤ | ~10MB | <3MB | Chrome DevTools |
| CPU –ø—Ä–∏ drag&drop | ~30% | <10% | Performance Monitor |

#### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–∞—è | –¶–µ–ª—å |
|---------|---------|------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~2000 | <500 |
| –§–∞–π–ª–æ–≤ | 8+ | 3 |
| –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | >10 | <5 |

### –¢–µ—Å—Ç—ã:
```javascript
// graphy/stores/__tests__/OptimisticStore.test.js
describe('OptimisticStore vs Legacy', () => {
  test('performance: add 100 nodes', () => {
    // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
  });
  
  test('memory: 1000 nodes', () => {
    // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–∞–º—è—Ç—å
  });
  
  test('offline: queue operations', () => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º offline —Ä–µ–∂–∏–º
  });
});
```

## –§–∞–∑–∞ 3: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 2)

### –î–µ–Ω—å 4: –ú–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```javascript
// –ë—ã–ª–æ:
import { TreeDaoStore } from './models/OptimisticTreeDaoStore';

// –°—Ç–∞–ª–æ:
import { TreeDaoStore } from './models/TreeDaoStore';
import { useOptimisticStore } from './hooks/useOptimisticStore';
```

### –î–µ–Ω—å 5: –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] addNode ‚Üí optimistic.addNode
- [ ] updateNode ‚Üí optimistic.updateNode  
- [ ] deleteNode ‚Üí optimistic.deleteNode
- [ ] saveGraph ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –î–µ–Ω—å 6-7: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
```bash
# –£–¥–∞–ª—è–µ–º –∫–æ—Å—Ç—ã–ª–∏
rm graphy/stores/models/OptimisticTreeDaoStore.js
rm graphy/stores/mixins/OptimisticMixin.js
rm graphy/services/optimisticAdapter.js
rm graphy/services/optimisticApi.js

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π backend
rm dao_api2/src/queue.js
rm dao_api2/src/worker.js
```

## –§–∞–∑–∞ 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 3)

### –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏—á–∏:

#### 4.1 –ë–∞—Ç—á–∏–Ω–≥ –æ–ø–µ—Ä–∞—Ü–∏–π
```javascript
class OptimisticStore {
  batchOperations(ops) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—á–∫–æ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    this.ws.send(JSON.stringify({
      type: 'BATCH',
      operations: ops
    }));
  }
}
```

#### 4.2 –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π
```javascript
const debouncedUpdate = debounce((nodeId, position) => {
  optimistic.updateNodePosition(nodeId, position);
}, 100);
```

#### 4.3 Conflict Resolution
```javascript
handleConflict(localOp, serverOp) {
  // Operational Transform –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
  const transformed = OT.transform(localOp, serverOp);
  this.applyLocal(transformed);
}
```

## –§–∞–∑–∞ 5: Production Ready (–ù–µ–¥–µ–ª—è 4)

### –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç:

#### Backend
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ (Prometheus)
- [ ] Rate limiting
- [ ] –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Frontend  
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] Retry –ª–æ–≥–∏–∫–∞
- [ ] Error boundaries
- [ ] –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏

#### DevOps
- [ ] Docker –æ–±—Ä–∞–∑—ã
- [ ] CI/CD pipeline
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ê–ª–µ—Ä—Ç—ã

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ (—Ç–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞):
```
üìÅ 8+ —Ñ–∞–π–ª–æ–≤
üìù ~2000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
üîß 3+ –∫–æ—Å—Ç—ã–ª—è
üêå 50ms latency
üíæ 10MB –ø–∞–º—è—Ç—å
ü§Ø –°–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å
```

### –ü–æ—Å–ª–µ (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞):
```
üìÅ 3 —Ñ–∞–π–ª–∞
üìù ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
‚ú® 0 –∫–æ—Å—Ç—ã–ª–µ–π
‚ö° 5ms latency
üíæ 2MB –ø–∞–º—è—Ç—å
üòä –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å
```

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| Regression bugs | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è + —Ç–µ—Å—Ç—ã |
| –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | Backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π |
| –ü—Ä–æ–±–ª–µ–º—ã —Å MST | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | OptimisticStore –∫–∞–∫ –æ–±—ë—Ä—Ç–∫–∞ |
| WebSocket –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–æ–µ | Auto-reconnect + offline queue |

## –ö–æ–º–∞–Ω–¥–∞ –∏ —Ä–æ–ª–∏

–î–ª—è –æ–¥–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- **–î–µ–Ω—å 1**: –ê–Ω–∞–ª–∏–∑ ‚úÖ
- **–î–µ–Ω—å 2**: POC
- **–î–µ–Ω—å 3**: –í–∞–ª–∏–¥–∞—Ü–∏—è
- **–ù–µ–¥–µ–ª—è 2**: –ú–∏–≥—Ä–∞—Ü–∏—è
- **–ù–µ–¥–µ–ª—è 3**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–ù–µ–¥–µ–ª—è 4**: Production

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ –µ—Å–ª–∏:
1. –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏–ª–∞—Å—å >50%
3. –ö–æ–¥ —É–º–µ–Ω—å—à–∏–ª—Å—è >70%
4. –ù–µ—Ç –∫–æ—Å—Ç—ã–ª–µ–π
5. –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å (–µ—Å–ª–∏ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏)

### Quick Fix (1 –¥–µ–Ω—å):
–ï—Å–ª–∏ –Ω–µ—Ç 4 –Ω–µ–¥–µ–ª—å –Ω–∞ –ø–æ–ª–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é, –º–æ–∂–Ω–æ:

1. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π backend
2. –ó–∞–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ frontend —á–∞—Å—Ç—å –Ω–∞ OptimisticStore
3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å backend –ø–æ–∑–∂–µ

–≠—Ç–æ —É–±–µ—Ä—ë—Ç –≥–ª–∞–≤–Ω—ã–µ –∫–æ—Å—Ç—ã–ª–∏ (`_optimistic_bypass`) –∏ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ 30-40%.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç–∏. –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ —Å—Ç–∏–ª–µ Figma/Miro:

- **–ü—Ä–æ—â–µ** –≤ 5 —Ä–∞–∑
- **–ë—ã—Å—Ç—Ä–µ–µ** –≤ 10 —Ä–∞–∑
- **–ù–∞–¥—ë–∂–Ω–µ–µ** –±–ª–∞–≥–æ–¥–∞—Ä—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é –∫–æ—Å—Ç—ã–ª–µ–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–µ–µ** –¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ–∏—á (–∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—è, CRDT)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ.** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π = –±–æ–ª—å—à–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞.

### –ü–µ—Ä–≤—ã–π —à–∞–≥:
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º –∏ —Å–æ–∑–¥–∞—ë–º –≤–µ—Ç–∫—É
git checkout -b clean-optimistic-architecture

# –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
touch dao_api2/src/simple-server.js
touch graphy/stores/OptimisticStore.js

# –ù–∞—á–∏–Ω–∞–µ–º —Å POC
```

–£—Å–ø–µ—Ö –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ 10 —Ä–∞–∑ –ø—Ä–æ—â–µ —Ç–µ–∫—É—â–µ–π.