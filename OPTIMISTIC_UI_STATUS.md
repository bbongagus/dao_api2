# Optimistic UI Backend - –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Backend (–ø–æ—Ä—Ç 3001)
- **REST API**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
  - `/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
  - `/api/users/:userId` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
  - `/api/users/:userId/graphs` - —Å–ø–∏—Å–æ–∫ –≥—Ä–∞—Ñ–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `/api/graphs/:graphId` - –∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤
  
- **WebSocket**: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è real-time –æ–ø–µ—Ä–∞—Ü–∏–π
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
  - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≥—Ä–∞—Ñ—ã
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ optimistic –æ–ø–µ—Ä–∞—Ü–∏–π
  - Broadcasting –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º

- **Redis**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤
  - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç–∏–ª–µ Figma/Miro**
  - –ü—Ä–æ—Å—Ç–æ–π WebSocket —Å–µ—Ä–≤–µ—Ä (309 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)
  - –ü—Ä—è–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å Redis
  - –ë–µ–∑ BullMQ –∏ –ª–∏—à–Ω–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
  - Event-driven –ø–æ–¥—Ö–æ–¥

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
# –ó–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç:
- optimistic-backend-clean (–ø–æ—Ä—Ç 3001)
- optimistic-redis-clean (–ø–æ—Ä—Ç 6379)
```

### Frontend –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `graphy/services/api.js` - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø–æ—Ä—Ç 3001
- `graphy/services/graphApi.js` - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø–æ—Ä—Ç 3001
- WebSocket URL: `ws://localhost:3001`

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
–û—Ç–∫—Ä—ã—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `graphy/test-optimistic.html`

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- REST API endpoints
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- Optimistic –æ–ø–µ—Ä–∞—Ü–∏–∏ (ADD_NODE, UPDATE_NODE, DELETE_NODE)
- Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ Health check
- ‚úÖ User API 
- ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Broadcasting –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
```bash
cd dao_api2
docker-compose -f docker-compose.clean.yml ps
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–µ—Ä–∞
```bash
curl http://localhost:3001/health
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
```bash
open graphy/test-optimistic.html
```

### 4. –í –±—Ä–∞—É–∑–µ—Ä–µ:
1. –ù–∞–∂–º–∏—Ç–µ "Connect WebSocket" –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
2. –ù–∞–∂–º–∏—Ç–µ "Subscribe" –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –Ω–æ–¥–∞–º–∏
4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –ª–æ–≥–∏ –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### REST API
```javascript
// –ü–æ–ª—É—á–∏—Ç—å –≥—Ä–∞—Ñ
fetch('http://localhost:3001/api/graphs/main')
  .then(res => res.json())
  .then(data => console.log(data));

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä–∞—Ñ
fetch('http://localhost:3001/api/graphs/main', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    nodes: [...],
    edges: [...],
    viewport: { x: 0, y: 0, zoom: 1 }
  })
});
```

### WebSocket –æ–ø–µ—Ä–∞—Ü–∏–∏
```javascript
const ws = new WebSocket('ws://localhost:3001');

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≥—Ä–∞—Ñ
ws.send(JSON.stringify({
  type: 'SUBSCRIBE',
  graphId: 'main'
}));

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É (optimistic)
ws.send(JSON.stringify({
  type: 'OPERATION',
  graphId: 'main',
  operation: {
    id: 'op_1',
    type: 'ADD_NODE',
    payload: {
      id: 'node_123',
      title: 'New Node',
      position: { x: 100, y: 100 }
    }
  }
}));
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º Graphy
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å OptimisticStore –∫ TreeDaoStore
2. –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ API –≤—ã–∑–æ–≤—ã –Ω–∞ –Ω–æ–≤—ã–µ
3. –î–æ–±–∞–≤–∏—Ç—å WebSocket listeners –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å offline mode —Å queue

### –£–ª—É—á—à–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —Å–µ—Å—Å–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å conflict resolution –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å broadcasting –¥–ª—è –±–æ–ª—å—à–∏—Ö –≥—Ä–∞—Ñ–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–∞–π–ª–æ–≤—ã—Ö attachments

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ backend
```bash
docker-compose -f docker-compose.clean.yml logs -f backend
```

### –õ–æ–≥–∏ Redis
```bash
docker-compose -f docker-compose.clean.yml exec redis redis-cli MONITOR
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Redis
```bash
docker-compose -f docker-compose.clean.yml exec redis redis-cli
> KEYS graph:*
> GET graph:main
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **CORS**: –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è production
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ü–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º
3. **–†–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–æ–≤**: –ë–æ–ª—å—à–∏–µ –≥—Ä–∞—Ñ—ã –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å broadcasting

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./SIMPLE_ARCHITECTURE.md)
- [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏](./CLEAN_MIGRATION_ROADMAP.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é](./CLEAN_TESTING_GUIDE.md)
- [–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä](./ARCHITECTURE_COMPARISON.md)

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Optimistic UI Backend –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏