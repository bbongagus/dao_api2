# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ –¥—Ä—É–≥–æ–π, —Ö–æ—Ç—è —Å–µ—Ä–≤–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–ª "Broadcasted to 2 clients".

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ remote –æ–ø–µ—Ä–∞—Ü–∏–π –≤ TreeDaoStore (`applyRemoteOperation`)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ EventBus
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ clientId

### 2. –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ Redis
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–∞–ª–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Redis
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ REST API –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

## –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### Backend (dao_api2/src/simple-server.js)
1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Redis:
   - `üìñ Getting graph` - –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - `üíæ Saving graph` - –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏  
   - `‚úÖ Graph saved` - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   - `‚ùå Redis error` - –æ—à–∏–±–∫–∏

2. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket –æ–ø–µ—Ä–∞—Ü–∏–π:
   - `üì® Message from client X` - –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `üì§ Sent to client X` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É
   - `üì¢ Operation broadcasted` - —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º

3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ PING/PONG –¥–ª—è heartbeat

4. REST API —Ç–µ–ø–µ—Ä—å —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

### Frontend (graphy/)

#### graphy/services/optimisticApi.js
- –î–æ–±–∞–≤–ª–µ–Ω—ã callbacks –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π:
  - `onRemoteOperation` - –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
  - `onGraphState` - –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
  - `onGraphUpdated` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ REST

#### graphy/stores/mixins/OptimisticIntegration.js
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ EventBus
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥—Ä–∞—Ñ–∞
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ remote –æ–ø–µ—Ä–∞—Ü–∏–π

#### graphy/stores/models/TreeDaoStore.js
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `applyRemoteOperation` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è EventBus –≤ `afterCreate`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ `beforeDestroy`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ clientId

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

1. **–ö–ª–∏–µ–Ω—Ç –ê** –¥–µ–ª–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–¥—É)
2. TreeDaoStore –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ OptimisticIntegration
3. WebSocket –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. –°–µ—Ä–≤–µ—Ä:
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∫ –≥—Ä–∞—Ñ—É –≤ –ø–∞–º—è—Ç–∏
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≥—Ä–∞—Ñ –≤ Redis
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –í–°–ï–ú –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º (–≤–∫–ª—é—á–∞—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
5. **–ö–ª–∏–µ–Ω—Ç –ë** –ø–æ–ª—É—á–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ WebSocket
6. OptimisticAPI –≤—ã–∑—ã–≤–∞–µ—Ç `onRemoteOperation`
7. OptimisticIntegration —ç–º–∏—Ç–∏—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ EventBus
8. TreeDaoStore –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `applyRemoteOperation`
9. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞
2. –í –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–¥—É
3. –ù–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### Backend –ª–æ–≥–∏
```bash
cd dao_api2
docker-compose -f docker-compose.clean.yml logs -f backend
```

### Frontend –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- `‚úÖ WebSocket connected` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- `üì® WebSocket message` - –ø–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `üîÑ Remote operation` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- `üì§ Operation sent` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

## –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏

1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis
3. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
4. ‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–µ—Å–ª–∏ –¥–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑–º–µ–Ω—è—é—Ç –æ–¥–Ω—É –Ω–æ–¥—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
5. ‚è≥ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–π
6. ‚è≥ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     WebSocket      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Browser A  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ             ‚îÇ
‚îÇ   (Tab 1)   ‚îÇ                     ‚îÇ   Backend   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ   (Node.js) ‚îÇ
                                    ‚îÇ             ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     WebSocket      ‚îÇ             ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Browser B  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ             ‚îÇ ‚óÑ‚îÄ‚îÄ‚ñ∫ ‚îÇ  Redis  ‚îÇ
‚îÇ   (Tab 2)   ‚îÇ                     ‚îÇ             ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–û–ø–µ—Ä–∞—Ü–∏–∏:
1. ADD_NODE, UPDATE_NODE, DELETE_NODE
2. ADD_EDGE, DELETE_EDGE
3. UPDATE_NODE_POSITION
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫
cd dao_api2
docker-compose -f docker-compose.clean.yml up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose -f docker-compose.clean.yml down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.clean.yml restart

# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö Redis
docker exec -it optimistic-redis-clean redis-cli FLUSHALL